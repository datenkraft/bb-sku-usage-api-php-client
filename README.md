# Backbone - SKU Usage API PHP Client

## Introduction

The SKU Usage API PHP Client enables you to work with the SKU Usage API.  

This PHP package is generated by an API client generator.

## Prerequisites

- PHP 7.2 or later for production

## Installation

You can use [Composer](https://getcomposer.org/). Follow the [installation instructions](https://getcomposer.org/doc/00-intro.md) if you do not already have composer installed.

~~~~ bash
composer require datenkraft/bb-sku-usage-api-php-client
~~~~

In your PHP script, make sure you include the autoloader:

~~~~ php
require 'path/to/vendor/autoload.php';
~~~~

## Using the library

###Creating a client
~~~~ php
require 'path/to/vendor/autoload.php';

$factory = new ClientFactory();
$client = \Datenkraft\Backbone\Client\SkuUsageApi\Client::createWithFactory($factory);
~~~~

###Sending SKU Usage data 
~~~~ php
$data = [];

$meta = new SkuUsageMeta();
$meta->setAmount(101)->setCurrency('EUR')->setDescription('description');

$base = new NewSkuUsage();
$base->setExternalId('12')
    ->setMeta($meta)
    ->setProjectId('2')
    ->setQuantity(1)
    ->setSkuId('ab')
    ->setUsageEnd(new \DateTime())
    ->setUsageStart(new \DateTime());

$meta2 = new SkuUsageMeta();
$meta2->setAmount(101)->setCurrency('EUR')->setDescription('description');

$base2 = new NewSkuUsage();
$base2->setExternalId('14')
    ->setMeta($meta2)
    ->setProjectId('2')
    ->setQuantity(1)
    ->setSkuId('newab')
    ->setUsageEnd(new \DateTime())
    ->setUsageStart(new \DateTime());

$data = [$base, $base2];

$response = $client->addSkuUsage($data);
~~~~

## Configuration
Default configuration variables are set in config/config.php

### Changing the default authorisation configuration
To override default authorization configuration, create a new configuration array and pass it to the factory construct:

~~~~ php
$clientId = '1234';
$clientSecret = 'abcd';
$oAuthScopes = ['sku-usage:add'];
$oAuthTokenUrl = 'https://authorization-server-url/oauth/token';

$config['clientId'] = $clientId;
$config['clientSecret'] = $clientSecret;
$config['oAuthScopes'] = $oAuthScopes;
$config['oAuthTokenUrl'] = $oAuthTokenUrl;

$factory = new ClientFactory($config);
~~~~

### Changing the default Sku Usage server Url
To override Sku Usage server Url, pass the Url when creating Client:
~~~~ php
$skuUsageApiUrl = 'https://sku-usage-server-url';
$client = \Datenkraft\Backbone\Client\SkuUsageApi\Client::createWithFactory($factory, $skuUsageApiUrl);
~~~~

## Development notes
### Generating the Models, Endpoints and Normalizers
1. Copy openapi.json to the project root folder
2. Check the Jane Php configuration file, should look like this
~~~~ php
return [
    'openapi-file' => __DIR__ . '/openapi.json',
    'namespace' => 'Datenkraft\Backbone\Client\SkuUsageApi\Generated',
    'directory' => __DIR__ . '/src/Generated',
    'use-fixer' => true
];
~~~~
3. Run the generator from CLI
~~~~ bash
php vendor/bin/jane-openapi generate
~~~~

## Licence
This repository is available under the [MIT license](https://opensource.org/licenses/MIT).
