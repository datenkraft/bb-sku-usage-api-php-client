# Backbone - SKU Usage API PHP Client

## Introduction

The SKU Usage API PHP Client enables you to work with the SKU Usage API.  

This PHP package is generated by an API client generator.

## Prerequisites

- PHP 7.2 or later for production

## Installation

You can use [Composer](https://getcomposer.org/). Follow the [installation instructions](https://getcomposer.org/doc/00-intro.md) if you do not already have composer installed.

~~~~ bash
composer require datenkraft/bb-sku-usage-api-php-client
~~~~

In your PHP script, make sure you include the autoloader:

~~~~ php
require __DIR__ . '/vendor/autoload.php';
~~~~

## Using the library

###Creating a client
~~~~ php
require __DIR__ . '/vendor/autoload.php';
$oAuthTokenUrl = 'https://bb_authorization_api:3000/oauth/token';
$skuUsageApiUrl = 'https://bb_sku_usage_api:3000';

// Valid clientId, clientSecret and requested scopes
$clientId = '1234';
$clientSecret = 'abcd';
$oAuthScopes = ['sku-usage:add'];
$config['clientId'] = $clientId;
$config['clientSecret'] = $clientSecret;
$config['oAuthScopes'] = $oAuthScopes;
$config['oAuthTokenUrl'] = $oAuthTokenUrl;

$factory = new ClientFactory($config);

$client= $factory->createClient(Client::class, $skuUsageApiUrl);
~~~~

###Sending SKU Usage data 
~~~~ php
$data = [];

$meta = new SkuUsageMeta();
$meta->setAmount(101)->setCurrency('EUR')->setDescription('description');

$base = new SkuUsageBase();
$base->setExternalId('12')
    ->setMeta($meta)
    ->setProjectId('2')
    ->setQuantity(1)
    ->setSkuId('ab')
    ->setUsageEnd(new \DateTime())
    ->setUsageStart(new \DateTime());

$meta2 = new SkuUsageMeta();
$meta2->setAmount(101)->setCurrency('EUR')->setDescription('description');

$base2 = new SkuUsageBase();
$base2->setExternalId('14')
    ->setMeta($meta2)
    ->setProjectId('2')
    ->setQuantity(1)
    ->setSkuId('newab')
    ->setUsageEnd(new \DateTime())
    ->setUsageStart(new \DateTime());

$data = [$base, $base2];

$response = $client->addSkuUsage(
    $data,
    \Datenkraft\Backbone\Client\SkuUsageApi\Generated\Client::FETCH_RESPONSE
);
echo "Response:";
echo $response->getBody();
~~~~


## Generating the Models, Endpoints and Normalizers
1. Copy openapi.json to the project root folder
2. Check the Jane Php configuration file, should look like this

~~~~ php
return [
    'openapi-file' => __DIR__ . '/openapi.json',
    'namespace' => 'Datenkraft\Backbone\Client\SkuUsageApi\Generated',
    'directory' => __DIR__ . '/src/Generated',
    'use-fixer' => true
];
~~~~
3. Run the generator from CLI
~~~~ bash
php vendor/bin/jane-openapi generate
~~~~

## Licence
This repository is available under the [MIT license](https://opensource.org/licenses/MIT).
